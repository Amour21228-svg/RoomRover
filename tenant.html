<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Locataire - RoomRover</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="js/auth-client.js"></script>
    <script src="js/rbac-guard.js"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <script src="components/navbar.js"></script>
    <script src="components/tenant-sidebar.js"></script>
    <script src="components/footer.js"></script>
    <script>
        // Protect this page - only tenant role allowed
        new RBACGuard('tenant');
    </script>
    <custom-navbar></custom-navbar>
    
    <div class="flex">
        <custom-tenant-sidebar></custom-tenant-sidebar>
        
        <main class="flex-1 p-8 ml-0 md:ml-64">
            <!-- Tab Navigation -->
            <div class="flex gap-2 mb-8 border-b border-gray-200 dark:border-gray-700 flex-wrap">
                <button class="tab-btn active px-4 py-2 border-b-2 border-blue-600 font-medium text-blue-600 dark:text-blue-400" data-tab="dashboard">
                    <i data-feather="home" class="inline w-4 h-4 mr-2"></i> Tableau de bord
                </button>
                <button class="tab-btn px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600" data-tab="rental">
                    <i data-feather="key" class="inline w-4 h-4 mr-2"></i> Ma location
                </button>
                <button class="tab-btn px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600" data-tab="payments">
                    <i data-feather="dollar-sign" class="inline w-4 h-4 mr-2"></i> Paiements
                </button>
                <button class="tab-btn px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600" data-tab="documents">
                    <i data-feather="file-text" class="inline w-4 h-4 mr-2"></i> Documents
                </button>
                <button class="tab-btn px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600" data-tab="messages">
                    <i data-feather="mail" class="inline w-4 h-4 mr-2"></i> Messages
                </button>
                <button class="tab-btn px-4 py-2 border-b-2 border-transparent font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600" data-tab="settings">
                    <i data-feather="settings" class="inline w-4 h-4 mr-2"></i> Paramètres
                </button>
            </div>

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Mon espace locataire</h1>
                    <p class="text-gray-600 dark:text-gray-300">Gérez votre location et paiements</p>
                    <div class="mt-4">
                        <a href="./pages/search.html" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i data-feather="search" class="inline w-4 h-4 mr-2"></i> Rechercher une chambre
                        </a>
                    </div>
                </div>
                
                <!-- Current Rental -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-6">Ma location actuelle</h2>
                    
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="flex-shrink-0">
                            <img src="http://static.photos/house/320x240/1" alt="Property" class="w-full md:w-64 rounded-lg">
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Chambre 2 - Résidence du Parc</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">12 Rue du Parc, Paris, 75016</p>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Type</p>
                                    <p class="text-gray-800 dark:text-white">Chambre avec salle de bain privée</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Superficie</p>
                                    <p class="text-gray-800 dark:text-white">18 m²</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Loyer mensuel</p>
                                    <p class="text-gray-800 dark:text-white">450€</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Caution</p>
                                    <p class="text-gray-800 dark:text-white">900€ (payée)</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-2">
                                <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">
                                    <i data-feather="check" class="w-3 h-3 inline mr-1"></i> Contrat signé
                                </span>
                                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                                    <i data-feather="check" class="w-3 h-3 inline mr-1"></i> Caution payée
                                </span>
                                <span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400">
                                    <i data-feather="check" class="w-3 h-3 inline mr-1"></i> Premier loyer payé
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rental Tab -->
            <div id="tab-rental" class="tab-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Ma location</h1>
                    <p class="text-gray-600 dark:text-gray-300">Détails et actions concernant votre location actuelle.</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Contrat</h2>
                    <p class="mb-4 text-gray-600 dark:text-gray-300">Contrat signé le 15/10/2023</p>
                    <a href="./pages/documents.html" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                        <i data-feather="download" class="inline w-4 h-4 mr-2"></i> Télécharger contrat
                    </a>
                </div>
            </div>

            <!-- Payments Tab -->
            <div id="tab-payments" class="tab-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Calendrier de paiement</h1>
                    <p class="text-gray-600 dark:text-gray-300">Gérez vos paiements de loyer.</p>
                    <div class="mt-4">
                        <button id="openPaymentModal" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i data-feather="credit-card" class="inline w-4 h-4 mr-2"></i> Payer maintenant
                        </button>
                    </div>
                </div>

                <!-- Payment Modal -->
                <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 w-full max-w-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Paiement du loyer</h3>
                            <button id="closePaymentModal" class="text-gray-400 hover:text-gray-500">
                                <i data-feather="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <p class="text-gray-600 dark:text-gray-300 mb-2">Montant à payer: <span class="font-semibold text-gray-800 dark:text-white">450€</span></p>
                            <p class="text-gray-600 dark:text-gray-300">Pour: <span class="font-semibold text-gray-800 dark:text-white">Décembre 2023</span></p>
                        </div>
                        
                        <h4 class="text-lg font-medium text-gray-800 dark:text-white mb-3">Méthode de paiement</h4>
                        <payment-methods></payment-methods>
                        <div class="mt-6">
                            <payment-form></payment-form>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Mois</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Montant</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date limite</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Statut</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">Novembre 2023</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">450€</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">05/11/2023</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                                            Payé
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                        <a href="./pages/receipt.html" class="text-blue-600 hover:text-blue-900 dark:text-blue-400">
                                            <i data-feather="download" class="w-4 h-4 inline"></i> Reçu
                                        </a>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">Décembre 2023</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">450€</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">05/12/2023</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400">
                                            En attente
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                        <a href="javascript:void(0)" class="open-payment text-blue-600 hover:text-blue-900 dark:text-blue-400">
                                            <i data-feather="credit-card" class="w-4 h-4 inline"></i> Payer
                                        </a>
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">Janvier 2024</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">450€</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900 dark:text-white">05/01/2024</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                            À venir
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                        <span class="text-gray-400 dark:text-gray-500">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Documents Tab -->
            <div id="tab-documents" class="tab-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Mes documents</h1>
                    <p class="text-gray-600 dark:text-gray-300">Accédez à vos contrats et reçus.</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <p class="text-gray-600 dark:text-gray-300 mb-6">Contrats et reçus...</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition duration-300">
                            <div class="flex items-center justify-between mb-2">
                                <i data-feather="file-text" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                <span class="text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 px-2 py-1 rounded-full">PDF</span>
                            </div>
                            <h4 class="font-medium text-gray-800 dark:text-white mb-1">Contrat de location</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Signé le 15/10/2023</p>
                            <a href="./pages/documents.html" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm font-medium">
                                <i data-feather="download" class="w-4 h-4 inline mr-1"></i> Télécharger
                            </a>
                        </div>
                        
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition duration-300">
                            <div class="flex items-center justify-between mb-2">
                                <i data-feather="file-text" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                <span class="text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 px-2 py-1 rounded-full">PDF</span>
                            </div>
                            <h4 class="font-medium text-gray-800 dark:text-white mb-1">Reçu de caution</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Payée le 15/10/2023</p>
                            <a href="./pages/documents.html" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm font-medium">
                                <i data-feather="download" class="w-4 h-4 inline mr-1"></i> Télécharger
                            </a>
                        </div>
                        
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition duration-300">
                            <div class="flex items-center justify-between mb-2">
                                <i data-feather="file-text" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                <span class="text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 px-2 py-1 rounded-full">PDF</span>
                            </div>
                            <h4 class="font-medium text-gray-800 dark:text-white mb-1">Reçu de loyer Novembre</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Payé le 01/11/2023</p>
                            <a href="./pages/documents.html" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm font-medium">
                                <i data-feather="download" class="w-4 h-4 inline mr-1"></i> Télécharger
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Tab -->
            <div id="tab-messages" class="tab-content hidden">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-8">Messages</h1>
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <p class="text-gray-600 dark:text-gray-300">Boîte de réception...</p>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="tab-settings" class="tab-content hidden">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-8">Paramètres</h1>
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                    <p class="text-gray-600 dark:text-gray-300">Paramètres du compte...</p>
                </div>
            </div>
        </main>
    </div>
    
    <custom-footer></custom-footer>
    
    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="components/tenant-sidebar.js"></script>
    <script src="components/payment-methods.js"></script>
    <script src="components/payment-form.js"></script>
    <script>
        feather.replace();

        // Tab Navigation Handler
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });
                
                // Remove active state from all buttons
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active', 'border-blue-600', 'text-blue-600', 'dark:text-blue-400');
                    b.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-300');
                });
                
                // Show selected tab
                document.getElementById('tab-' + tabName).classList.remove('hidden');
                
                // Mark button as active
                btn.classList.add('active', 'border-blue-600', 'text-blue-600', 'dark:text-blue-400');
                btn.classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-300');
                
                feather.replace();
            });
        });

        // Payment Modal
        document.getElementById('openPaymentModal').addEventListener('click', () => {
            document.getElementById('paymentModal').classList.remove('hidden');
        });
        
        document.getElementById('closePaymentModal').addEventListener('click', () => {
            document.getElementById('paymentModal').classList.add('hidden');
        });

        // Attach handlers to links that should open the payment modal
        document.querySelectorAll('a.open-payment').forEach(a => {
            a.addEventListener('click', (e) => {
                e.preventDefault();
                const btn = document.getElementById('openPaymentModal');
                if (btn) btn.click();
            });
        });
    </script>
</body>
</html>
